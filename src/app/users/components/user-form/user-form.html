<div class="user-form-container">
  <mat-card class="form-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>{{ isEditMode ? 'edit' : 'person_add' }}</mat-icon>
        {{ isEditMode ? 'Editar usuário' : 'Criar novo usuário' }}
      </mat-card-title>
      <mat-card-subtitle>
        {{ isEditMode ? 'Atualizar informações do usuário' : 'Adicionar um novo usuário ao sistema' }}
      </mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <!-- Loading Spinner -->
      <div *ngIf="loading" class="loading-container">
        <mat-spinner diameter="50"></mat-spinner>
        <p>Carregando dados do usuário...</p>
      </div>

      <!-- User Form -->
      <form *ngIf="!loading" [formGroup]="userForm" (ngSubmit)="onSubmit()" class="user-form">
        <!-- Name Field -->
        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Nome completo</mat-label>
          <input 
            matInput 
            formControlName="name"
            placeholder="Digite o nome completo"
            maxlength="50"
            required>
          <mat-hint>Digite o nome completo (apenas letras e espaços)</mat-hint>
          <mat-error *ngIf="hasError('name')">
            {{ getErrorMessage('name') }}
          </mat-error>
        </mat-form-field>

        <!-- Email Field -->
        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Endereço de email</mat-label>
          <input 
            matInput 
            formControlName="email"
            type="email"
            placeholder="Digite o endereço de email"
            maxlength="100"
            required>
          <mat-hint>Digite um endereço de email válido</mat-hint>
          <mat-error *ngIf="hasError('email')">
            {{ getErrorMessage('email') }}
          </mat-error>
        </mat-form-field>

        <!-- Status Field -->
        <div class="form-field status-toggle-container">
          <label class="status-label">Status</label>
          <div class="status-toggle-wrapper">
            <button 
              type="button"
              mat-stroked-button
              [class.active]="userForm.get('status')?.value === 'active'"
              [class.inactive]="userForm.get('status')?.value === 'inactive'"
              (click)="toggleStatus()"
              [disabled]="submitting"
              class="status-toggle-button">
              <mat-icon *ngIf="userForm.get('status')?.value === 'active'">check_circle</mat-icon>
              <mat-icon *ngIf="userForm.get('status')?.value === 'inactive'">cancel</mat-icon>
              {{ userForm.get('status')?.value === 'active' ? 'Active' : 'Inactive' }}
            </button>
          </div>
          <div class="status-hint">Clique para alternar entre Ativo e Inativo</div>
          <div *ngIf="hasError('status')" class="status-error">
            {{ getErrorMessage('status') }}
          </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button 
            type="button" 
            mat-stroked-button 
            color="tertiary"
            (click)="onCancel()"
            [disabled]="submitting">
            <mat-icon>cancel</mat-icon>
            Cancelar
          </button>
          
          <button 
            type="submit" 
            mat-stroked-button 
            color="primary"
            [disabled]="userForm.invalid || submitting">
            <mat-icon *ngIf="!submitting">
              {{ isEditMode ? 'save' : 'add' }}
            </mat-icon>
            <mat-spinner *ngIf="submitting" diameter="20"></mat-spinner>
            {{ submitting ? 'Salvando...' : (isEditMode ? 'Atualizar usuário' : 'Criar usuário') }}
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- Form Validation Summary -->
  <mat-card *ngIf="userForm.invalid && userForm.touched" class="validation-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon color="warn">warning</mat-icon>
        Por favor, corrija os seguintes erros:
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <ul class="validation-errors">
        <li *ngIf="userForm.get('name')?.invalid && userForm.get('name')?.touched">
          <strong>Nome:</strong> {{ getErrorMessage('name') }}
        </li>
        <li *ngIf="userForm.get('email')?.invalid && userForm.get('email')?.touched">
          <strong>Endereço de email:</strong> {{ getErrorMessage('email') }} 
        </li>
        <li *ngIf="userForm.get('status')?.invalid && userForm.get('status')?.touched">
          <strong>Status:</strong> {{ getErrorMessage('status') }} 
        </li>
      </ul>
    </mat-card-content>
  </mat-card>
</div>
